<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/styles.css">
    <title>Enter Grades - EduBridge</title>
    <style>
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 10px; text-align: left; border: 1px solid #ddd; }
        th { background-color: rgba(255, 255, 255, 0.1); color: white; }
        .grade-input { width: 100px; padding: 5px; text-align: center; }
        .subject-section { margin-bottom: 30px; }
    </style>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="navbar-container">
            <div class="navbar-links">
                <a href="/teacher_dashboard" class="nav-link">Dashboard</a>
                <div class="dropdown">
                    <a href="#" class="nav-link dropdown-trigger active">Classes</a>
                    <div class="dropdown-content">
                        <a href="/manage_schedule">
                            <span class="dropdown-item-icon">📅</span>
                            <span class="dropdown-item-content">
                                <span class="dropdown-item-title">Manage Schedule</span>
                                <span class="dropdown-item-description">Create and edit class schedules</span>
                            </span>
                        </a>
                        <a href="/mark_attendance">
                            <span class="dropdown-item-icon">✅</span>
                            <span class="dropdown-item-content">
                                <span class="dropdown-item-title">Mark Attendance</span>
                                <span class="dropdown-item-description">Track student attendance</span>
                            </span>
                        </a>
                        <a href="/enter_grades">
                            <span class="dropdown-item-icon">📊</span>
                            <span class="dropdown-item-content">
                                <span class="dropdown-item-title">Enter Grades</span>
                                <span class="dropdown-item-description">Record student grades</span>
                            </span>
                        </a>
                        <a href="/manage_students">
                            <span class="dropdown-item-icon">👥</span>
                            <span class="dropdown-item-content">
                                <span class="dropdown-item-title">Enroll Students</span>
                                <span class="dropdown-item-description">Manage student enrollments</span>
                            </span>
                        </a>
                    </div>
                </div>
                <div class="dropdown">
                    <a href="#" class="nav-link dropdown-trigger">Assignments</a>
                    <div class="dropdown-content">
                        <a href="/add_assignment">
                            <span class="dropdown-item-icon">➕</span>
                            <span class="dropdown-item-content">
                                <span class="dropdown-item-title">Add Assignment</span>
                                <span class="dropdown-item-description">Create new assignments</span>
                            </span>
                        </a>
                        <a href="/manage_assignments">
                            <span class="dropdown-item-icon">📝</span>
                            <span class="dropdown-item-content">
                                <span class="dropdown-item-title">Manage Assignments</span>
                                <span class="dropdown-item-description">Edit and organize assignments</span>
                            </span>
                        </a>
                    </div>
                </div>
                <div class="dropdown">
                    <a href="#" class="nav-link dropdown-trigger">Analytics</a>
                    <div class="dropdown-content">
                        <a href="/teacher_analytics">
                            <span class="dropdown-item-icon">📈</span>
                            <span class="dropdown-item-content">
                                <span class="dropdown-item-title">View Analytics</span>
                                <span class="dropdown-item-description">Class performance insights</span>
                            </span>
                        </a>
                        <a href="/teacher_reports">
                            <span class="dropdown-item-icon">📄</span>
                            <span class="dropdown-item-content">
                                <span class="dropdown-item-title">View Reports</span>
                                <span class="dropdown-item-description">Generate detailed reports</span>
                            </span>
                        </a>
                    </div>
                </div>
                <a href="/teacher_settings" class="nav-link">Settings</a>
            </div>
            <div class="navbar-actions">
                <a href="/logout" class="nav-btn">Logout</a>
            </div>
        </div>
    </div>

    <div class="center-wrapper">
        <div class="dashboard-container card-3d">
            <h1>Enter Grades</h1>

            {% for subject in subjects %}
            <div class="subject-section">
                <h2>{{ subject['name'] }}</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Assignments & Grades</th>
                            <th>Add New Assignment</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set filtered_assignments = students_assignments|selectattr('subject_name', 'equalto', subject['name'])|list %}
                        {% set ns = namespace(last_student='') %}

                        {% for item in filtered_assignments %}
                            {% if item['student_name'] != ns.last_student %}
                                {% if ns.last_student != '' %}
                                    </td>
                                    <td>
                                        <form method="post" style="display: inline;">
                                            <input type="hidden" name="student_id" value="{{ item['student_id'] }}">
                                            <input type="hidden" name="subject_id" value="{{ subject['id'] }}">
                                            <input type="text" name="assignment_name" placeholder="Assignment name" required>
                                            <input type="number" name="grade" placeholder="Grade" class="grade-input" min="0" max="100" required>
                                            <button type="submit" class="btn-3d">Add</button>
                                        </form>
                                    </td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <td>{{ item['student_name'] }}</td>
                                    <td>
                            {% endif %}

                            {% if item['assignment_name'] %}
                                <form method="post" style="display: inline-block; margin-right: 15px;">
                                    <input type="hidden" name="assignment_id" value="{{ item['assignment_id'] }}">
                                    <input type="hidden" name="student_id" value="{{ item['student_id'] }}">
                                    <input type="hidden" name="subject_id" value="{{ subject['id'] }}">
                                    {{ item['assignment_name'] }}:
                                    <input type="number" name="grade" value="{{ item['grade'] }}" class="grade-input" min="0" max="100" required>
                                    <button type="submit" class="btn-3d">Update</button>
                                </form>
                            {% endif %}

                            {% set ns.last_student = item['student_name'] %}
                        {% endfor %}

                        {% if filtered_assignments %}
                            </td>
                            <td>
                                <form method="post" style="display: inline;">
                                    <input type="hidden" name="student_id" value="{{ filtered_assignments[-1]['student_id'] }}">
                                    <input type="hidden" name="subject_id" value="{{ subject['id'] }}">
                                    <input type="text" name="assignment_name" placeholder="Assignment name" required>
                                    <input type="number" name="grade" placeholder="Grade" class="grade-input" min="0" max="100" required>
                                    <button type="submit" class="btn-3d">Add</button>
                                </form>
                            </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            {% endfor %}

            <div class="action-buttons">
                <a class="btn-3d" href="/teacher_dashboard">Back to Dashboard</a>
            </div>
        </div>
    </div>
</body>
</html>